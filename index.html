<!DOCTYPE html>
<html lang="ja">
    <head>
        <meta http-equiv="CONTENT-TYPE" content="text/html; charset=utf-8">
        <title>WebGazer デモ</title>
        <script type="text/javascript" src="webgazer.js"></script>
    </head>
    <body>
        <p id="p_x">X</p><br>
        <p id="p_y">Y</p><br>
        <video id="video" width="720" height="560" autoplay muted></video><br>
        <p id="err">エラーなし</p>

        <script>
            const txt_x = document.getElementById("p_x");
            const txt_y = document.getElementById("p_y");
            const txt_err = document.getElementById('err');
            const player = document.getElementById('video');

            /**カメラを用いたビデオストリーミング**/
            function startVideo() {
                var constraints = {
                    audio: true,
                    video: {
                    width: player.width,
                    height: player.height
                    }
                };
                
                navigator.mediaDevices.getUserMedia(constraints)
                .then(function(stream) {
                    player.srcObject = stream;
                    player.onloadedmetadata = function(e) {
                    player.play();
                    };
                })
                .catch(function(err) {
                    //console.log(err.name+": "+err.message);
                    txt_err.textContent = (err.name+": "+err.message);
                });
            }

            window.onload = function () {
                startVideo();
            }

            player.addEventListener('play', () => {
                setInterval(async () => {
                    var prediction = webgazer.getCurrentPrediction();
                    if(prediction) {
                        var x = prediction.x;
                        var y = prediction.y;
                    }
                    txt_x.textContent = x;
                    txt_y.textContent = y;
                }, 100)
            })
        </script>
    </body>
</html>